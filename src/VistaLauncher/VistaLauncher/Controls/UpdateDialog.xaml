<?xml version="1.0" encoding="utf-8" ?>
<ContentDialog
    x:Class="VistaLauncher.Controls.UpdateDialog"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:viewmodels="using:VistaLauncher.ViewModels"
    Title="检查更新"
    PrimaryButtonText="更新选中"
    SecondaryButtonText="全部更新"
    CloseButtonText="关闭"
    DefaultButton="Primary"
    PrimaryButtonClick="PrimaryButton_Click"
    SecondaryButtonClick="SecondaryButton_Click">

    <Grid MinWidth="550" MinHeight="300">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- 顶部状态��息 -->
        <StackPanel Grid.Row="0" Spacing="8" Margin="0,0,0,16">
            <StackPanel Orientation="Horizontal" Spacing="8">
                <TextBlock x:Name="StatusText" Style="{StaticResource SubtitleTextBlockStyle}"/>
                <ProgressRing x:Name="CheckingRing" IsActive="False" Width="20" Height="20"/>
            </StackPanel>
            <TextBlock x:Name="LastCheckText" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
        </StackPanel>

        <!-- 更新列表 -->
        <ListView
            x:Name="UpdateListView"
            Grid.Row="1"
            SelectionMode="Multiple"
            SelectionChanged="UpdateListView_SelectionChanged"
            MaxHeight="350">
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="viewmodels:UpdateItemViewModel">
                    <Grid Padding="12" ColumnSpacing="12" Background="{ThemeResource CardBackgroundFillColorDefaultBrush}">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- 工具名称和版本 -->
                        <StackPanel Grid.Row="0" Grid.Column="0" Spacing="4">
                            <TextBlock Text="{x:Bind Name}" FontWeight="SemiBold"/>
                            <TextBlock Foreground="{ThemeResource TextFillColorSecondaryBrush}">
                                <Run Text="当前版本: "/>
                                <Run Text="{x:Bind CurrentVersion}"/>
                            </TextBlock>
                            <TextBlock Foreground="{ThemeResource SystemFillColorSuccessBrush}">
                                <Run Text="最新版本: "/>
                                <Run Text="{x:Bind LatestVersion}"/>
                            </TextBlock>
                        </StackPanel>

                        <!-- 更新按钮 -->
                        <Button
                            Grid.Row="0"
                            Grid.Column="1"
                            Content="下载页面"
                            Click="OpenPageButton_Click"
                            Tag="{x:Bind}"/>

                        <!-- 更新进度 -->
                        <ProgressBar
                            Grid.Row="1"
                            Grid.ColumnSpan="2"
                            Value="{x:Bind UpdateProgress, Mode=OneWay}"
                            Maximum="100"
                            Height="4"
                            Margin="0,8,0,0"
                            x:Name="ItemProgressBar"/>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <!-- 底部进度 -->
        <StackPanel
            x:Name="ProgressPanel"
            Grid.Row="2"
            Spacing="8"
            Margin="0,16,0,0"
            Visibility="Collapsed">
            <TextBlock x:Name="ProgressText"/>
            <ProgressBar x:Name="ProgressBar" Maximum="100"/>
        </StackPanel>
    </Grid>
</ContentDialog>
