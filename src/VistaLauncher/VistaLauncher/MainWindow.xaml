<?xml version="1.0" encoding="utf-8"?>
<winuiex:WindowEx x:Class="VistaLauncher.MainWindow"
                  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                  xmlns:controls="using:VistaLauncher.Controls"
                  xmlns:local="using:VistaLauncher"
                  xmlns:vm="using:VistaLauncher.ViewModels"
                  xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
                  xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
                  xmlns:winuiex="using:WinUIEx"
                  Width="800"
                  Height="480"
                  MinWidth="320"
                  MinHeight="240"
                  mc:Ignorable="d">

    <Grid x:Name="RootElement">
        <Grid.RowDefinitions>
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Main Content Area -->
        <Grid Grid.Row="0" Background="{ThemeResource LayerOnAcrylicPrimaryBackgroundBrush}">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- Top Bar: App Icon + Search Box -->
            <Grid x:Name="TopBarGrid"
                  Padding="0,12,0,12"
                  HorizontalAlignment="Stretch"
                  VerticalAlignment="Stretch"
                  BorderBrush="{ThemeResource CmdPal.TopBarBorderBrush}"
                  BorderThickness="0,0,0,1">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="*" />
                </Grid.ColumnDefinitions>

                <!-- App Icon -->
                <Image Grid.Column="0"
                       Width="20"
                       Margin="20,0,6,0"
                       HorizontalAlignment="Center"
                       VerticalAlignment="Center"
                       Source="ms-appx:///Assets/icon.svg" />

                <!-- Search Box: wrapped in a grid to enable RepositionThemeTransitions -->
                <Grid Grid.Column="1" HorizontalAlignment="Stretch">
                    <controls:SearchBar x:Name="SearchBox"
                                        HorizontalAlignment="Stretch"
                                        Text="{x:Bind ViewModel.SearchQuery, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                    <Grid.Transitions>
                        <TransitionCollection>
                            <RepositionThemeTransition />
                        </TransitionCollection>
                    </Grid.Transitions>
                </Grid>
            </Grid>

            <!-- Content: Tools List with ScrollView -->
            <Grid Grid.Row="1">
                <ScrollView VerticalScrollBarVisibility="Auto"
                            VerticalScrollMode="Auto"
                            MaxHeight="360">
                    <ListView x:Name="ToolsListView"
                              ItemsSource="{x:Bind ViewModel.FilteredTools, Mode=OneWay}"
                              SelectedItem="{x:Bind ViewModel.SelectedTool, Mode=TwoWay}"
                              SelectionMode="Single"
                              IsItemClickEnabled="True"
                              ItemClick="ToolsListView_ItemClick"
                              Background="Transparent"
                              Padding="8,4,8,4"
                              ItemContainerStyle="{StaticResource LauncherListItemStyle}">

                        <ListView.ItemTemplate>
                            <DataTemplate x:DataType="vm:ToolItemViewModel">
                                <Grid Padding="12,10,12,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="28" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <!-- Icon -->
                                    <Grid Grid.Column="0"
                                          Width="20"
                                          Height="20"
                                          VerticalAlignment="Center"
                                          HorizontalAlignment="Center">
                                        <FontIcon Glyph="&#xE74C;"
                                                  Foreground="{ThemeResource TextFillColorTertiaryBrush}"
                                                  FontSize="16"
                                                  Visibility="{x:Bind local:Converters.IsNullToVisibility(IconImage), Mode=OneWay}" />
                                        <Image Source="{x:Bind IconImage, Mode=OneWay}"
                                               Width="20"
                                               Height="20"
                                               Stretch="Uniform" />
                                    </Grid>

                                    <!-- Title + Subtitle -->
                                    <StackPanel Grid.Column="1"
                                                VerticalAlignment="Center"
                                                Margin="12,0,0,0">
                                        <TextBlock Text="{x:Bind Name}"
                                                   Foreground="{ThemeResource TextFillColorPrimaryBrush}"
                                                   FontSize="14"
                                                   TextTrimming="CharacterEllipsis" />
                                        <TextBlock Text="{x:Bind Subtitle}"
                                                   Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                                                   FontSize="12"
                                                   TextTrimming="CharacterEllipsis"
                                                   Visibility="{x:Bind local:Converters.BoolToVisibility(ShowSubtitle)}" />
                                    </StackPanel>

                                    <!-- Shortcut Key Badge -->
                                    <Border Grid.Column="2"
                                            Style="{StaticResource HotkeyBorderStyle}"
                                            Visibility="{x:Bind local:Converters.BoolToVisibility(ShowShortcutKey)}">
                                        <TextBlock Text="{x:Bind ShortcutKeyDisplay}"
                                                   Style="{StaticResource HotkeyTextStyle}" />
                                    </Border>
                                </Grid>
                            </DataTemplate>
                        </ListView.ItemTemplate>
                    </ListView>
                </ScrollView>
            </Grid>
        </Grid>

        <!-- Command Bar -->
        <Grid Grid.Row="1"
              Background="{ThemeResource LayerOnAcrylicSecondaryBackgroundBrush}"
              BorderBrush="{ThemeResource CmdPal.DividerStrokeColorDefaultBrush}"
              BorderThickness="0,1,0,0">
            <controls:CommandBar x:Name="CommandBar"
                                HasSelection="{x:Bind ViewModel.HasSelectedTool, Mode=OneWay}"
                                StatusText="{x:Bind ViewModel.StatusText, Mode=OneWay}" />
        </Grid>
    </Grid>
</winuiex:WindowEx>
