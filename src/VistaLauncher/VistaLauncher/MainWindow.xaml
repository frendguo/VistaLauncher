<?xml version="1.0" encoding="utf-8"?>
<Window
    x:Class="VistaLauncher.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:VistaLauncher"
    xmlns:vm="using:VistaLauncher.ViewModels"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Title="VistaLauncher">

    <!-- 主容器：深色背景，占满整个窗口 -->
    <Grid x:Name="RootGrid" Background="#2D2D30">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- 搜索框区域 -->
        <Grid Grid.Row="0" Height="52" Padding="16,0">
            <TextBox 
                x:Name="SearchBox"
                PlaceholderText="Search for Apps and Files"
                Text="{x:Bind ViewModel.SearchQuery, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                Background="Transparent"
                BorderThickness="0"
                Foreground="White"
                FontSize="18"
                VerticalAlignment="Center"
                PlaceholderForeground="#808080"
                KeyDown="SearchBox_KeyDown"/>
        </Grid>
        
        <!-- 分隔线 (展开时显示) -->
        <Border Grid.Row="0" 
                VerticalAlignment="Bottom"
                Height="1" 
                Background="#454545"
                Visibility="{x:Bind ViewModel.ListVisibility, Mode=OneWay}"/>

        <!-- 结果列表 -->
        <ListView
            x:Name="ToolsListView"
            Grid.Row="1"
            Visibility="{x:Bind ViewModel.ListVisibility, Mode=OneWay}"
            ItemsSource="{x:Bind ViewModel.FilteredTools, Mode=OneWay}"
            SelectedItem="{x:Bind ViewModel.SelectedTool, Mode=TwoWay}"
            SelectionMode="Single"
            IsItemClickEnabled="True"
            ItemClick="ToolsListView_ItemClick"
            DoubleTapped="ToolsListView_DoubleTapped"
            Background="Transparent"
            Padding="0,4,0,4">
            
            <ListView.ItemContainerStyle>
                <Style TargetType="ListViewItem">
                    <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                    <Setter Property="Padding" Value="0"/>
                    <Setter Property="Margin" Value="0"/>
                    <Setter Property="MinHeight" Value="52"/>
                    <Setter Property="Background" Value="Transparent"/>
                </Style>
            </ListView.ItemContainerStyle>
            
            <ListView.ItemTemplate>
                <DataTemplate x:DataType="vm:ToolItemViewModel">
                    <Grid Height="52" Padding="16,0" Background="Transparent">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="40"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <!-- 图标 -->
                        <Grid Grid.Column="0" Width="32" Height="32" VerticalAlignment="Center">
                            <FontIcon Glyph="&#xE74C;" 
                                      Foreground="#606060" 
                                      FontSize="24"
                                      Visibility="{x:Bind local:Converters.IsNullToVisibility(IconImage), Mode=OneWay}"/>
                            <Image Source="{x:Bind IconImage, Mode=OneWay}" 
                                   Width="32" Height="32"
                                   Stretch="Uniform"/>
                        </Grid>
                        
                        <!-- 名称 -->
                        <TextBlock Grid.Column="1" 
                                   Text="{x:Bind Name}" 
                                   Foreground="White"
                                   FontSize="14"
                                   VerticalAlignment="Center"
                                   Margin="8,0,0,0"
                                   TextTrimming="CharacterEllipsis"/>
                        
                        <!-- 快捷键 -->
                        <TextBlock Grid.Column="2" 
                                   Text="{x:Bind ShortcutKeyDisplay}" 
                                   Foreground="#707070"
                                   FontSize="13"
                                   VerticalAlignment="Center"
                                   Margin="16,0,0,0"
                                   Visibility="{x:Bind ShowShortcutKey}"/>
                    </Grid>
                </DataTemplate>
            </ListView.ItemTemplate>
        </ListView>

        <!-- 加载指示器 -->
        <ProgressRing 
            Grid.Row="1"
            IsActive="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
            Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay}"
            Width="24" Height="24"
            HorizontalAlignment="Center"
            VerticalAlignment="Center"/>
    </Grid>
</Window>
